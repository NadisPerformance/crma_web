{"ast":null,"code":"var _jsxFileName = \"/Users/belabed90/Documents/GitHub/crma_web/components/album/MultiUpload.js\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport { Query, Mutation, useMutation } from 'react-apollo';\nimport { create_album } from './queries';\nimport { create_image } from '../image/queries';\nimport ImageDeleteButton from '../image/DeleteButton';\nexport default class MultiUpload extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"fileObj\", []);\n\n    _defineProperty(this, \"fileArray\", []);\n\n    this.state = {\n      file: [null],\n      albumId: null,\n      album: {\n        title: \"Test\"\n      },\n      image: {\n        albumId: null,\n        file: null\n      },\n      uploaded_images: []\n    };\n    this.uploadFile = this.uploadFile.bind(this);\n    this.uploadFiles = this.uploadFiles.bind(this);\n  }\n\n  componentDidMount() {//const [createAlbum, { data }] = useMutation(createAlbum);\n    //createAlbum({ variables: { data:this.state.album } });\n  }\n\n  async uploadFile(file) {\n    if (!file) return null;\n    this.setImageFile(file);\n    console.log(file);\n    if (!this.state.albumId) await this.createAlbum().then(result => {\n      this.setAlbumId(result.data.createAlbum.id);\n    });\n    this.uploadImage().then(result => {\n      this.state.uploaded_images.push(result.data.createImage);\n      this.setState({\n        uploaded_images: this.state.uploaded_images\n      }); //alert(\"Image uploaded \"+result.data.createImage.id)\n    });\n    this.fileObj.push(file);\n    this.fileArray.push(URL.createObjectURL(file)); //  console.log(this.fileObj)\n    //this.setState({ file: this.fileArray })\n  }\n\n  uploadFiles(e) {\n    e.preventDefault();\n    console.log(this.state.file);\n  }\n\n  setAlbumId(value) {\n    this.state.image.albumId = value * 1;\n    this.state.albumId = value * 1;\n    this.setState({\n      image: this.state.image\n    });\n    this.setState({\n      albumId: value * 1\n    });\n    this.onChange();\n  }\n\n  async createAlbum() {}\n\n  setImageFile(file) {\n    this.state.image.file = file;\n    console.log(file);\n    this.setState({\n      image: this.state.image\n    });\n  }\n\n  deleteImage(imageId) {\n    var images = this.state.uploaded_images;\n\n    for (var i = 0; i < images.length; i++) if (images[i].id == imageId) delete images[i];\n\n    this.setState({\n      uploaded_images: images\n    });\n  }\n\n  onChange() {\n    if (this.props.onChange) this.props.onChange(this.state.albumId);\n  }\n\n  render() {\n    const {\n      album,\n      albumId\n    } = this.state;\n    return __jsx(Mutation, {\n      mutation: create_album,\n      variables: {\n        data: this.state.album\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 11\n      }\n    }, postMutation => {\n      this.createAlbum = postMutation;\n      return __jsx(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 22\n        }\n      }, (this.state.uploaded_images || []).map(image => __jsx(\"div\", {\n        className: \"col-sm-12 row\",\n        style: {\n          backgroundColor: 'white',\n          padding: '2px',\n          margin: '2px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 17\n        }\n      }, __jsx(\"div\", {\n        className: \"col-sm-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 21\n        }\n      }, __jsx(\"img\", {\n        src: image.image_url,\n        alt: \"...\",\n        width: \"100px\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 25\n        }\n      })), __jsx(\"div\", {\n        className: \"col-sm-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 21\n        }\n      }), __jsx(\"div\", {\n        className: \"col-sm-4\",\n        style: {\n          padding: '30px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 21\n        }\n      }, __jsx(ImageDeleteButton, {\n        imageId: image.id,\n        onDelete: imageId => this.deleteImage(imageId),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 23\n        }\n      })))), __jsx(\"div\", {\n        className: \"form-group\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 17\n        }\n      }, __jsx(\"input\", {\n        type: \"file\",\n        className: \"form-control\",\n        id: \"file\",\n        onChange: ({\n          target: {\n            validity,\n            files: [file]\n          }\n        }) => this.uploadFile(file),\n        _multiple: true,\n        style: {\n          display: 'none'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }\n      })), __jsx(Mutation, {\n        mutation: create_image,\n        variables: {\n          data: this.state.image\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 17\n        }\n      }, postMutation => {\n        this.uploadImage = postMutation;\n        return __jsx(\"button\", {\n          type: \"button\",\n          className: \"btn btn-danger btn-block\",\n          onClick: () => document.getElementById('file').click(),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 23\n          }\n        }, \"Charger des photos\");\n      }));\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/belabed90/Documents/GitHub/crma_web/components/album/MultiUpload.js"],"names":["React","Component","Query","Mutation","useMutation","create_album","create_image","ImageDeleteButton","MultiUpload","constructor","props","state","file","albumId","album","title","image","uploaded_images","uploadFile","bind","uploadFiles","componentDidMount","setImageFile","console","log","createAlbum","then","result","setAlbumId","data","id","uploadImage","push","createImage","setState","fileObj","fileArray","URL","createObjectURL","e","preventDefault","value","onChange","deleteImage","imageId","images","i","length","render","postMutation","map","backgroundColor","padding","margin","image_url","target","validity","files","display","document","getElementById","click"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { Query, Mutation , useMutation} from 'react-apollo'\nimport {create_album} from './queries'\nimport {create_image} from '../image/queries'\nimport ImageDeleteButton from '../image/DeleteButton'\nexport default class MultiUpload extends Component {\n\n    fileObj = [];\n    fileArray = [];\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            file: [null],\n            albumId:null,\n            album:{\n              title:\"Test\"\n            },\n            image:{\n              albumId:null,\n              file: null\n            },\n            uploaded_images:[]\n        }\n        this.uploadFile = this.uploadFile.bind(this)\n        this.uploadFiles = this.uploadFiles.bind(this)\n    }\n    componentDidMount(){\n      //const [createAlbum, { data }] = useMutation(createAlbum);\n      //createAlbum({ variables: { data:this.state.album } });\n    }\n    async uploadFile(file) {\n        if(!file )\n          return null\n        this.setImageFile(file)\n        console.log(file)\n        if(  !this.state.albumId )\n          await this.createAlbum().then((result)=>{\n            this.setAlbumId(result.data.createAlbum.id)\n          })\n        this.uploadImage().then((result)=>{\n          this.state.uploaded_images.push(result.data.createImage)\n          this.setState({uploaded_images:this.state.uploaded_images})\n          //alert(\"Image uploaded \"+result.data.createImage.id)\n        })\n        this.fileObj.push(file)\n        this.fileArray.push(URL.createObjectURL(file))\n      //  console.log(this.fileObj)\n        //this.setState({ file: this.fileArray })\n    }\n\n    uploadFiles(e) {\n        e.preventDefault()\n        console.log(this.state.file)\n    }\n    setAlbumId(value){\n      this.state.image.albumId =  value * 1\n      this.state.albumId = value * 1\n      this.setState({image:this.state.image})\n      this.setState({albumId:value *1})\n      this.onChange()\n    }\n    async createAlbum(){\n\n    }\n    setImageFile(file){\n       this.state.image.file = file\n       console.log(file)\n       this.setState({image:this.state.image})\n    }\n    deleteImage(imageId){\n      var images = this.state.uploaded_images\n      for(var i= 0; i < images.length; i++)\n        if( images[i].id == imageId)\n          delete images[i]\n      this.setState({uploaded_images:images})\n    }\n    onChange(){\n      if(this.props.onChange)\n        this.props.onChange(this.state.albumId)\n    }\n    render() {\n        const {album, albumId} = this.state\n        return (\n          <Mutation mutation={create_album} variables={{data:this.state.album}} >\n            {postMutation => {\n             this.createAlbum = postMutation\n             return (<React.Fragment>\n               {(this.state.uploaded_images || []).map(image => (\n                <div className=\"col-sm-12 row\" style={{backgroundColor:'white',padding:'2px',margin:'2px'}}>\n                    <div className=\"col-sm-4\" >\n                        <img src={image.image_url} alt=\"...\" width=\"100px\" />\n                    </div>\n                    <div className=\"col-sm-4\" >\n                    </div>\n                    <div className=\"col-sm-4\" style={{padding: '30px'}} >\n                      <ImageDeleteButton imageId={image.id} onDelete={(imageId)=>this.deleteImage(imageId)} />\n                    </div>\n                </div>\n               ))}\n                <div className=\"form-group\">\n                    <input type=\"file\" className=\"form-control\" id=\"file\" onChange={({target: {validity,files: [file],},})=>this.uploadFile(file)} _multiple  style={{display:'none'}}/>\n                </div>\n                <Mutation mutation={create_image} variables={{data:this.state.image}} >\n                  {postMutation =>{\n                    this.uploadImage = postMutation\n                    return (\n                      <button type=\"button\" className=\"btn btn-danger btn-block\" onClick={()=>document.getElementById('file').click()}>Charger des photos</button>\n                    )\n                  } }\n                </Mutation>\n            </React.Fragment >\n          )}\n          }\n        </Mutation>\n        )\n    }\n}\n"]},"metadata":{},"sourceType":"module"}